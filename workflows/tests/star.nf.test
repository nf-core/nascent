nextflow_pipeline {

    name "Test Workflow main.nf with STAR"
    script "../../main.nf"
    tag "aligner"
    tag "star"

    test("Should run with STAR (default)") {

        when {
            params {
                outdir = "$outputDir"
                aligner = "star"
            }
        }

        then {
            assert workflow.success
            assert snapshot(
                workflow.trace.tasks().size(),
            ).match()
        }
    }

    test("Should run with gzipped gtf") {

        when {
            params {
                outdir = "$outputDir"
                aligner = "star"
                gtf = "https://raw.githubusercontent.com/nf-core/test-datasets/nascent/reference/genes_chr21.gtf.gz"
            }
        }

        then {
            assert workflow.success
            assert snapshot(
                workflow.trace.tasks().size(),
            ).match()
        }
    }
}
